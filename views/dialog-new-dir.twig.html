{% extends "flm::dialog-window.twig.html" %}
{% block content %}
    <div>
        {{ window.pathBrowser('New Folder', theUILang.Name) }}
    </div>
{% endblock %}
{% block scripts %}
    <script type="text/javascript">
        (function (global) {
            var dialogs = flm.ui.getDialogs();
            var diagId = dialogs.getDialogId();
            var nameInput = dialogs.dirBrowserInput(diagId);

            flm.ui.getDialogs().onStart(
                function () {
                    var dirname = flm.utils.basename(nameInput.val());
                    var currentPath = flm.getCurrentPath();
                    var hasError;

                    if (!dirname) {
                        hasError = theUILang.fDiagInvalidname;
                    } else if (flm.ui.browser.fileExists(dirname)) {
                        hasError = theUILang.fDiagAexist;
                    }

                    if ($type(hasError)) {
                        var def = $.Deferred();
                        def.reject({errcode: theUILang.fcNewDir, msg: hasError + ' - ' + dirname});
                    }

                    return $type(hasError)
                        ? def.promise()
                        : flm.api.mkDir(flm.getCurrentPath(dirname))
                            .done(function (response) {
                                flm.Refresh();
                                return response;
                            });

            });

            nameInput.parent().on('submit', function () {
                flm.ui.dialogs.startButton('mkdir').click();
                return false
            });
            setTimeout(function () {
                nameInput.click();
                nameInput.select();
            });
        })
        (window);
    </script>
{% endblock %}




